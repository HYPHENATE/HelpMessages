jobs:
  install_authenticate_test:
    executor: sfdx/default
    steps:
      - checkout
      - sfdx/install
      - sfdx/auth:
          defaultusername: daniel@hyphen8.com
          scratch-alias: scratch
          scratch-def: './config/project-scratch-def.json'
      - run:
          command:
            sfdx force:org:create -f <<parameters.scratch-def>> -a <<parameters.scratch-alias>>
          name: Create Scratch Org
      - run:
          command: 
            sfdx force:source:push
          name: Push App To Scratch Org
       - run:
          command:
            sfdx force:apex:test:run --wait 10 --resultformat junit --codecoverage --testlevel RunLocalTests
          name: Run Unit Tests
      - run:
          command: 
            sfdx force:org:delete --noprompt
          name: Delete scratch org
orbs:
  sfdx: circleci/salesforce-sfdx@1.0.0
version: 2.1
workflows:
  package-test:
    jobs:
      - install_authenticate_test